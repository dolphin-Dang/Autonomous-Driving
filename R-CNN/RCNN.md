[知乎--RCNN系列详解](https://zhuanlan.zhihu.com/p/383167028)

# R-CNN
第一个将CNN引入目标检测算法。分为四个阶段：
1. 产生候选区域 Selective Search
   1. Hierarchical Grouping Algorithm 层次化组合相近的类似部分。先把图片划分为一些部分，两两计算不同部分的相似度；每次取出最相似的相邻部分合并；重复以上步骤。
   2. Diversification Strategies 多样化策略。色彩、纹理、形状等多种相似度度量。
2. 特征提取：将输入缩放之后输入AlexNet
3. 候选区域类别判断：
   1. 将输出特征图输入21个SVM，其中20个类别和一个背景类，得到每一类的概率
   2. 用非极大值抑制NMS去除冗余框
      1. 设置一个IoU阈值
      2. 从候选框列表中选取最高置信度的，添加进输出列表
      3. 把刚刚选的这个box和别的所有box计算IoU，大于阈值的删除
      4. 重复2、3步骤，直到候选列表为空，输出列表就是处理之后的结果
4. 回归器调整候选框位置

问题：
+ 速度慢
+ 重复计算
+ 训练困难：CNN、SVM等

# SPPNet
解决RCNN的暴力缩放问题，先用卷积处理不同尺度的输入，然后用一个空间金字塔池化层 Spatial Pyramid Pooling 解决全连接层输入尺寸问题。

就是用不同尺度的池化层提取特征，然后拼接起来输入全连接层。

# Fast R-CNN
相比前作优点：
+ 更高准确率
+ 使用多任务损失，从多阶段训练升级为单阶段训练，一次更新全部参数
+ 不需要大量硬盘空间存储CNN提取的特征

基本流程：
1. Selective Search
2. 对整张图片提取一个特征，并将上一步提取的候选框映射到这个特征map上
   1. 借鉴了SPPNet
3. ROI Pooling 将所有候选区域的特征全部缩放到固定大小 7*7，然后把这些特征输入全连接层，得到K类别和背景共(K+1)类的概率，以及每个类的预测边界框。

# Faster R-CNN
核心：提出 Region Proposal Network。

基本流程：
+ 提取特征
+ RPN给出anchor并投射到特征map上得到特征矩阵
+ 将每个特征矩阵ROI Pooling，通过FC得到分类及候选区域位置偏移信息

RPN：
+ 之前提取的特征图谱每一个点都是一个anchor核心
  + 每个点最终会生成9个anchor，分别有不同的形状和大小
+ 因此用通道数来区分对这个点的一些预测
+ 具体而言
  + 通过1*1卷积得到18channel的特征图，每2个channel代表一个anchor的类别，是背景还是物体
  + 通过另一个1*1卷积得到36channel特征图，每4个channel代表一个anchor的偏移量
+ 对目前获得的这么多anchor进行筛选
  + 超出边缘的裁剪
  + 太小的丢弃
  + 按是物体的概率排序，取前面的一部分
  + 用NMS合并，再取排序的前一部分

RPN训练时需要选取一部分anchor作为训练集，因为所有anchor太多了。用多任务损失函数。
